<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Casino Cricket</title>
  <style>
    :root {
      --bg-dark: #0a2e1f;
      --bg-gradient: linear-gradient(135deg, #0a2e1f 0%, #143d2e 100%);
      --gold: #ffd700;
      --gold-dark: #d4af37;
      --card-bg: #ffffff;
      --card-shadow: 0 8px 24px rgba(0,0,0,0.6);
      --text-light: #f0f0f0;
      --text-gold: var(--gold);
    }

    body {
      background: var(--bg-gradient);
      color: var(--text-light);
      font-family: 'Georgia', 'Palatino Linotype', serif;
      margin: 0;
      padding: 16px 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      touch-action: manipulation;
    }

    h1 {
      margin: 12px 0 16px;
      font-size: clamp(2.1rem, 7vw, 3.2rem);
      font-weight: 900;
      letter-spacing: 3px;
      color: var(--gold);
      text-shadow: 0 4px 14px rgba(0,0,0,0.9), 0 0 20px rgba(255,215,0,0.4);
    }

    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 20px 36px;
      margin-bottom: 16px;
      font-size: clamp(1.1rem, 4.5vw, 1.25rem);
      color: var(--text-light);
      justify-content: center;
      background: rgba(0,0,0,0.45);
      padding: 16px 28px;
      border-radius: 16px;
      border: 1px solid rgba(255,215,0,0.18);
      backdrop-filter: blur(10px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.5);
    }

    .sound-toggle-btn {
      background: none;
      border: none;
      color: var(--gold);
      font-size: 1.2rem;
      cursor: pointer;
      padding: 0 8px;
      font-weight: bold;
    }

    .high-score {
      color: var(--gold);
      font-weight: bold;
      text-shadow: 0 1px 6px rgba(0,0,0,0.8);
    }

    .rules-toggle {
      margin: 12px 0 20px;
      padding: 14px 32px;
      font-size: 1.15rem;
      background: linear-gradient(145deg, #2a4a3a, #3a5a4a);
      color: white;
      border: 2px solid rgba(255,215,0,0.3);
      border-radius: 12px;
      cursor: pointer;
      min-height: 56px;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }

    .rules-toggle:hover, .rules-toggle:active {
      background: linear-gradient(145deg, #3a5a4a, #4a6a5a);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255,215,0,0.25);
    }

    .help {
      background: rgba(0,0,0,0.65);
      padding: 24px 32px;
      border-radius: 16px;
      margin-bottom: 28px;
      max-width: 820px;
      width: 100%;
      text-align: left;
      font-size: clamp(1.05rem, 4vw, 1.15rem);
      line-height: 1.65;
      box-sizing: border-box;
      display: none;
      border: 2px solid rgba(255,215,0,0.35);
      backdrop-filter: blur(16px);
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    }

    .help.show {
      display: block;
      animation: fadeInUp 0.5s ease-out;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .controls {
      display: flex;
      gap: 24px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      padding: 16px 36px;
      font-size: clamp(1.05rem, 4.5vw, 1.2rem);
      font-weight: bold;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-height: 60px;
      touch-action: manipulation;
      box-shadow: 0 6px 16px rgba(0,0,0,0.5);
      letter-spacing: 1px;
    }

    #resetBtn {
      background: linear-gradient(145deg, #c62828, #b71c1c);
      color: white;
      text-transform: uppercase;
    }

    #resetBtn:hover, #resetBtn:active {
      background: linear-gradient(145deg, #b71c1c, #9a0007);
      transform: translateY(-3px);
      box-shadow: 0 10px 24px rgba(198,40,40,0.5);
    }

    #message {
      margin-bottom: 24px;
      font-size: clamp(1.3rem, 5.5vw, 1.5rem);
      min-height: 2.4rem;
      text-align: center;
      padding: 16px 28px;
      border-radius: 16px;
      font-weight: bold;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(12px);
      border: 2px solid transparent;
      transition: all 0.4s ease;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, auto);
      gap: clamp(16px, 4.5vw, 22px);
      max-width: 820px;
      width: 100%;
      padding: 0 12px;
      box-sizing: border-box;
    }

    .card-slot {
      width: 100%;
      height: 0;
      padding-bottom: 140%;
      background: rgba(30,50,40,0.6);
      border: 3px dashed rgba(255,255,255,0.18);
      border-radius: 16px;
      position: relative;
      overflow: hidden;
      transition: all 0.25s ease;
      cursor: pointer;
      user-select: none;
      touch-action: manipulation;
      box-shadow: inset 0 2px 12px rgba(0,0,0,0.6);
    }

    .card-slot:hover {
      border-color: rgba(255,215,0,0.5);
      box-shadow: 0 0 24px rgba(255,215,0,0.25), inset 0 2px 12px rgba(0,0,0,0.6);
    }

    .card-slot:active {
      transform: scale(0.97);
    }

    .card-slot.selected {
      border: 4px solid var(--gold) !important;
      box-shadow: 
        0 0 40px rgba(255,215,0,0.7),
        inset 0 4px 16px rgba(255,215,0,0.3),
        0 0 80px rgba(255,215,0,0.4) !important;
      transform: scale(1.08) translateY(-8px) !important;
      animation: pulse 1.5s infinite ease-in-out;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 40px rgba(255,215,0,0.7); }
      50%      { box-shadow: 0 0 60px rgba(255,215,0,1); }
    }

    .card {
      position: absolute;
      inset: 0;
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      overflow: hidden;
      user-select: none;
      transition: transform 0.25s ease;
    }

    /* Corner rank/number – NO suit symbol */
    .corner {
      position: absolute;
      width: 70px;
      text-align: center;
      line-height: 1;
      font-size: clamp(36px, 10vw, 54px);
      font-weight: 900;
      letter-spacing: -1px;
    }

    .top-left  { top: 4%; left: 8px; }
    .bottom-right {
      bottom: 4%;
      right: 8px;
      transform: rotate(180deg);
    }

    .number {
      color: #000;
    }

    .red   .number { color: #c00; }
    .black .number { color: #000; }

    /* Large center suit */
    .center {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(100px, 28vw, 180px);
      line-height: 1;
      opacity: 0.72;
      text-shadow: 0 0 20px rgba(0,0,0,0.6), 0 0 40px rgba(0,0,0,0.4);
      pointer-events: none;
      user-select: none;
      transition: all 0.3s ease;
    }

    .red   { color: #c00; }
    .black { color: #000; }

    /* Mobile adjustments */
    @media (max-width: 768px) {
      .corner {
        font-size: clamp(28px, 8vw, 40px);
        width: 50px;
      }
      .top-left  { top: 2%; left: 4px; }
      .bottom-right {
        bottom: 2%;
        right: 4px;
      }

      .center {
        font-size: clamp(70px, 22vw, 120px);
        opacity: 0.45;
      }
    }

    #gameOverModal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
      box-sizing: border-box;
    }

    .modal-content {
      background: linear-gradient(145deg, #1e1e1e, #2a2a2a);
      color: #f0f0f0;
      padding: clamp(28px, 8vw, 40px);
      border-radius: 20px;
      text-align: center;
      max-width: 460px;
      width: 92vw;
      box-shadow: 0 20px 60px rgba(0,0,0,0.9);
      border: 3px solid rgba(255,215,0,0.4);
    }

    .modal-content h2 {
      margin: 0 0 24px;
      color: #ff4444;
      font-size: clamp(1.8rem, 7vw, 2.4rem);
      text-shadow: 0 2px 8px rgba(255,68,68,0.5);
    }

    .new-high-score {
      color: #ffeb3b !important;
      font-size: 1.8rem !important;
      font-weight: 900 !important;
      margin: 16px 0 !important;
      padding: 12px 24px !important;
      background: rgba(0,0,0,0.4) !important;
      border-radius: 12px !important;
      text-shadow: 0 0 12px rgba(0,0,0,0.9), 2px 2px 6px rgba(0,0,0,0.7) !important;
      display: inline-block !important;
      border: 2px solid rgba(255,235,59,0.5);
    }

    .modal-content button {
      margin-top: 20px;
      padding: 16px 40px;
      font-size: 1.25rem;
      min-height: 60px;
      background: linear-gradient(145deg, #ffd700, #d4af37);
      color: #111;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.6);
      transition: all 0.3s ease;
    }

    .modal-content button:hover, .modal-content button:active {
      transform: translateY(-3px);
      box-shadow: 0 10px 24px rgba(255,215,0,0.5);
    }

    /* Sound unlock overlay */
    #soundUnlock {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      flex-direction: column;
      gap: 20px;
    }

    #soundUnlock.hidden {
      display: none;
    }

    #soundUnlock button {
      padding: 20px 48px;
      font-size: 1.5rem;
      background: var(--gold);
      color: #000;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 8px 24px rgba(0,0,0,0.6);
    }
  </style>
</head>
<body>

<div id="soundUnlock">
  <h2 style="color: var(--gold); font-size: 2.4rem; text-align: center; margin: 0;">Casino Cricket</h2>
  <p style="color: #eee; font-size: 1.3rem; text-align: center; max-width: 360px; margin: 12px 0;">
    Tap below to enable sound & begin
  </p>
  <button id="unlockSoundBtn">Enable Sound & Play</button>
</div>

<h1>Casino Cricket</h1>

<div class="stats">
  <span>Hands played: <strong id="movesCount">0</strong></span>
  <span>Chips: <strong id="score">0</strong></span>
  <span>Best pot: <strong id="highScore">0</strong></span>
  <span>Cards dealt: <strong id="cardsPlayed">0</strong></span>
  <span>Possible plays: <strong id="movesLeft">?</strong></span>
  <span>Sound: <button id="soundToggle" class="sound-toggle-btn">ON</button></span>
</div>

<button class="rules-toggle" id="rulesToggle">Show House Rules</button>

<div class="help" id="rulesPanel">
  <strong>House Rules – Casino Cricket</strong><br><br>
  Good evening, ladies and gentlemen.<br>
  We’re playing Cricket tonight — clean, sharp, no funny business.<br><br>

  • <strong>Pair</strong> — any two number cards that add up to eleven (Ace counts one).<br>
  • <strong>Cricket</strong> — the face trio: Jack, Queen, King — any order, any suit, no duplicates.<br>
  • Invalid call? Table resets the selection. Keep it tight.<br>
  • Deck runs dry? We reshuffle a fresh 52 — game continues.<br>
  • Board locks up with no legal plays? That’s the end of the hand.<br><br>

  <strong>Payout schedule:</strong><br>
  • Every card placed = +1 chip (starting nine included)<br>
  • Cricket in a straight line (row, column or diagonal) = +50 chip bonus<br>
  • All cards in the winning combination same suit = double the base payout for that play<br><br>

  Eyes on the table. Good luck.
</div>

<div class="controls">
  <button id="resetBtn">New Shoe (Full Reset)</button>
</div>

<div id="message"></div>

<div class="grid" id="grid"></div>

<div id="gameOverModal">
  <div class="modal-content">
    <h2>Hand Complete</h2>
    <p>No more legal plays remain on the table.</p>
    <p>Final pot: <strong id="finalScore">0</strong> chips</p>
    <p id="highScoreMessage"></p>
    <p>Would you like to start a fresh shoe?</p>
    <button id="restartBtn">Deal New Hand</button>
  </div>
</div>

<!-- Audio files from your GitHub Pages repo -->
<audio id="selectSound" preload="auto">
  <source src="https://guerillagardeningkzn-design.github.io/Cricket/sounds/select.mp3" type="audio/mpeg">
</audio>
<audio id="pairSound" preload="auto">
  <source src="https://guerillagardeningkzn-design.github.io/Cricket/sounds/pair.mp3" type="audio/mpeg">
</audio>
<audio id="cricketSound" preload="auto">
  <source src="https://guerillagardeningkzn-design.github.io/Cricket/sounds/cricket.mp3" type="audio/mpeg">
</audio>
<audio id="recordSound" preload="auto">
  <source src="https://guerillagardeningkzn-design.github.io/Cricket/sounds/record.mp3" type="audio/mpeg">
</audio>

<script>
// ────────────────────────────────────────────────
// Casino Cricket – sounds hosted from your repo
// ────────────────────────────────────────────────

const suits = [
  { name: '♥', color: 'red' },
  { name: '♦', color: 'red' },
  { name: '♣', color: 'black' },
  { name: '♠', color: 'black' }
];

const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

let deck = [];
let slots = [];
let selected = [];
let mode = null;
let movesCount = 0;
let score = 0;
let cardsPlayed = 0;
let highScore = 0;
let soundEnabled = true;

// Audio references
const selectSound   = document.getElementById('selectSound');
const pairSound     = document.getElementById('pairSound');
const cricketSound  = document.getElementById('cricketSound');
const recordSound   = document.getElementById('recordSound');

// Sound toggle in stats
document.getElementById('soundToggle').addEventListener('click', () => {
  soundEnabled = !soundEnabled;
  document.getElementById('soundToggle').textContent = soundEnabled ? 'ON' : 'OFF';
  showMessage(soundEnabled ? "Sound enabled" : "Sound muted", soundEnabled ? '#88ff88' : '#ff8888');
});

// Unlock audio context on first real user gesture
document.getElementById('unlockSoundBtn').addEventListener('click', () => {
  // Very quiet unlock sound to satisfy browser policy
  selectSound.volume = 0.05;
  selectSound.currentTime = 0;
  selectSound.play().catch(() => {});
  selectSound.pause();

  document.getElementById('soundUnlock').classList.add('hidden');
  showMessage("Sounds unlocked ✓ Tap cards to play!", '#88ff88');
});

// Safe play function
function playSound(audioEl) {
  if (soundEnabled && audioEl) {
    audioEl.currentTime = 0;
    audioEl.play().catch(() => {
      // Silent fail – common on first few plays or strict policies
    });
  }
}

// ─── High Score ────────────────────────────────────────
function loadHighScore() {
  const saved = localStorage.getItem('casinoCricketHighScore');
  if (saved !== null) {
    highScore = parseInt(saved, 10) || 0;
    document.getElementById('highScore').textContent = highScore;
  }
}

function saveHighScore() {
  if (score > highScore) {
    highScore = score;
    localStorage.setItem('casinoCricketHighScore', highScore);
    document.getElementById('highScore').textContent = highScore;
    return true;
  }
  return false;
}

function clearHighScore() {
  localStorage.removeItem('casinoCricketHighScore');
  highScore = 0;
  document.getElementById('highScore').textContent = 0;
}

// ─── Game logic continues (only showing changed parts) ──

function performReplace(indices, isTrio = false) {
  // ... (your existing logic up to score calculation)

  let msg = isTrio ? "Cricket!" : "Pair pays!";

  if (isTrio && isTrioInLine(indices)) {
    score += 50;
    msg += " Line bonus +50!";
    playSound(cricketSound);
    hapticFeedback('heavy');
  } else if (sameSuitBonus > 0) {
    msg += ` Suited double (+${sameSuitBonus})!`;
    playSound(pairSound);
    hapticFeedback('double');
  } else {
    playSound(pairSound);
    hapticFeedback('medium');
  }

  showMessage(msg, '#55ff88');
  updateStats();
  deselectAll();
  checkGameOver();
}

function handleSlotInteraction(slot, idx) {
  // ... (your existing logic)

  playSound(selectSound);
  hapticFeedback('light');

  // ... rest unchanged
}

function checkGameOver() {
  // ... (your existing logic)

  if (possible === 0) {
    const isNewRecord = saveHighScore();

    // ... existing modal setup ...

    if (isNewRecord) {
      // ... existing new record UI ...
      playSound(recordSound);
    }
  }
}

// ... rest of your script (initGrid, resetEverything, event listeners, start call) ...
</script>
</body>
</html>
